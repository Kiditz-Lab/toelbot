import{af as ee,N as w,ao as te,ag as ae,P as q,y as j,O as N,c as R,o as k,a0 as se,$ as oe,B as t,w as a,d as z,a as s,U as J,al as A,f as B,e as h,t as T,q as re,a5 as ne,a8 as le,an as ie,j as ce,k as G,_ as ue,am as de,ah as ge,aq as me,ad as fe,V as F,b as I}from"./index-B-4Jq8Ft.js";import{u as pe}from"./useApi-Bby6fr-m.js";import{S as be,C as ye,u as ve}from"./client-KZQCG3Am.js";import{u as we}from"./snackbarStore-KsQP317g.js";import{_ as _e}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as ke}from"./format-Bw9bORZr.js";import{D as he}from"./DeleteDialog-DqafGwoF.js";import{_ as O}from"./UiParentCard.vue_vue_type_script_setup_true_lang-D2f-MrwW.js";import{g as Se}from"./mdi-CCnSVLV7.js";import"./en-US-g4IfPCw7.js";const P=ee("trainingWebsiteStore",()=>{const p=pe(),n=w([]),{showSnackbar:o}=we(),l=w([]),g=w(!1),i=w(""),S=te(()=>p.loading),m=[u=>!!u||"URL is required",u=>/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/.test(u)||"Enter a valid URL"],b=ae(),C=w(null),c=w(""),r=w(0),e=w(null);async function f(){var _;const u=b.params.id;if(console.log("Crawl website"),(_=C.value)!=null&&_.validate()){const y=await p.get(`/crawl/${u}`,{url:c.value});console.log(y),o("Crawling in progress. This might take a few moments.","blue-grey",3e3,"Success")}}async function W(){const u="/ws",_=new be(u),y=b.params.id;if(!y){console.error("Agent ID is required for WebSocket connection.");return}e.value=new ye({webSocketFactory:()=>_,debug:V=>console.log(V),onConnect:()=>{var V,U,D,$;(V=e.value)==null||V.subscribe(`/topic/crawl-finish/${y}`,async d=>{try{console.log(d.body),await x(),o("Your website successfully crawled","info",3e3,"Success")}catch(v){console.error("Error parsing WebSocket message:",v)}}),(U=e.value)==null||U.subscribe(`/topic/crawl-chunk/${y}`,async d=>{try{console.log(d.body)}catch(v){console.error("Error parsing WebSocket message:",v)}}),(D=e.value)==null||D.subscribe(`/topic/training-delete/${y}`,async d=>{console.log(d.body),await x()}),($=e.value)==null||$.subscribe(`/topic/training/${y}`,d=>{try{const v=JSON.parse(d.body),M=l.value.findIndex(X=>X.id===v.id);M!==-1&&(l.value[M]=v),console.log("Received message:",v)}catch(v){console.error("Error parsing WebSocket message:",v)}})},onDisconnect:()=>{console.log("Disconnected from WebSocket")}}),e.value.activate()}const E=w({page:1,itemsPerPage:20,sortBy:[{key:"url",order:"asc"}]});async function x(){n.value=[];const u=b.params.id;if(u)try{const{page:_,itemsPerPage:y,sortBy:V}=E.value,U=V.filter(d=>d.order).map(d=>`${d.key},${d.order}`),D={page:_-1,size:y};U.length>0?D.sort=U:D.sort="url,asc";const $=await p.get(`/training-data/${u}`,{type:"LINK",search:i.value,...D});l.value=$.content,r.value=$.totalElements}catch(_){console.error("Error fetching websites:",_)}}async function K(u){await p.del(`/training-data/${u}`)}const Y=()=>{e.value&&e.value.deactivate()};async function Z(){await p.post("/training-data/train-website",n.value)}async function H(){g.value=!1,await p.del("/training-data",{ids:n.value})}async function Q(){g.value=!0}q(E,x,{deep:!0});let L;return q(i,()=>{clearTimeout(L),L=setTimeout(()=>{x()},500)}),{formRef:C,url:c,search:i,urlRules:m,crawlWebsite:f,loading:S,trainings:l,dialog:g,connect:W,disconnect:Y,fetchTrainingWebsite:x,trainWebsite:Z,deleteTrainingData:K,options:E,totalItems:r,selectedItems:n,openDeleteDialog:Q,confirmDelete:H}},{persist:!1}),Ce={class:"d-flex align-center justify-center"},Ve=j({__name:"TrainingWebsite",setup(p){const{url:n,urlRules:o,loading:l,formRef:g}=N(P()),{crawlWebsite:i}=P();return(S,m)=>(k(),R(se,{ref_key:"formRef",ref:g,onSubmit:oe(t(i),["prevent"])},{default:a(()=>[z("div",Ce,[s(J,{modelValue:t(n),"onUpdate:modelValue":m[0]||(m[0]=b=>A(n)?n.value=b:null),rules:t(o),required:"",variant:"outlined",density:"compact",label:"URL"},{append:a(()=>[s(B,{loading:t(l),color:"black",density:"comfortable",type:"submit",class:"h-100"},{default:a(()=>m[1]||(m[1]=[h("Crawl")])),_:1},8,["loading"])]),_:1},8,["modelValue","rules"])])]),_:1},8,["onSubmit"]))}}),De=_e(Ve,[["__scopeId","data-v-dc9ad70a"]]),Te=["href"],Re={class:"text-subtitle-2 font-weight-bold text-truncate"},We={__name:"TrainingWebsiteList",setup(p){const{trainings:n,options:o,totalItems:l,loading:g,selectedItems:i}=N(P()),{formatFileSize:S}=ve(),m=c=>{switch(c){case"PENDING":return"info";case"ERROR":return"error";case"TRAINED":return"success";default:return"default"}},b=c=>c.charAt(0).toUpperCase()+c.slice(1).toLowerCase(),C=c=>ke(new Date(c),"MMM dd/yyyy h:mm a");return(c,r)=>(k(),R(ge,{"items-per-page":t(o).itemsPerPage,"onUpdate:itemsPerPage":r[0]||(r[0]=e=>t(o).itemsPerPage=e),page:t(o).page,"onUpdate:page":r[1]||(r[1]=e=>t(o).page=e),"sort-by":t(o).sortBy,"onUpdate:sortBy":r[2]||(r[2]=e=>t(o).sortBy=e),items:t(n),loading:t(g),"items-length":t(l),modelValue:t(i),"onUpdate:modelValue":r[3]||(r[3]=e=>A(i)?i.value=e:null),"show-select":"",class:"elevation-0",headers:[{key:"status",title:"STATUS",sortable:!1},{key:"url",title:"DATASOURCE",sortable:!0},{key:"size",title:"SIZE",sortable:!0},{key:"createdAt",title:"CREATED",sortable:!0}],"items-per-page-options":[{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"},{value:200,title:"200"},{value:400,title:"400"},{value:600,title:"600"}]},{"item.status":a(({item:e})=>[s(ce,{color:m(e.status),label:""},{default:a(()=>[e.progress?(k(),R(ue,{key:0,start:""},{default:a(()=>[s(de,{indeterminate:"",color:m(e.status),size:"x-large"},null,8,["color"])]),_:2},1024)):G("",!0),h(" "+T(b(e.status)),1)]),_:2},1032,["color"])]),"item.url":a(({item:e})=>[e.website?(k(),R(ne,{key:1,variant:"text",density:"compact",href:e.url,target:"_blank",class:"ma-1"},{prepend:a(()=>[s(le,{class:"mr-3"},{default:a(()=>[s(ie,{src:e.website.image,alt:"Website image"},null,8,["src"])]),_:2},1024)]),title:a(()=>[z("div",Re,T(e.website.title),1)]),subtitle:a(()=>[h(T(e.website.description),1)]),_:2},1032,["href"])):(k(),re("a",{key:0,href:e.url,target:"_blank",class:"text-decoration-none text-black"},T(e.url),9,Te))]),"item.createdAt":a(({item:e})=>[h(T(C(e.createdAt)),1)]),"item.size":a(({item:e})=>[h(T(t(S)(e.size)),1)]),_:1},8,["items-per-page","page","sort-by","items","loading","items-length","modelValue"]))}},xe={class:"d-flex align-center flex-wrap ga-2 w-50"},Me=j({__name:"TrainingWebsitePage",setup(p){const{trainings:n,loading:o,search:l,dialog:g,selectedItems:i}=N(P()),{confirmDelete:S,fetchTrainingWebsite:m,connect:b,disconnect:C,trainWebsite:c,openDeleteDialog:r}=P();return me(()=>{m(),b()}),fe(()=>{C()}),(e,f)=>(k(),R(F,null,{default:a(()=>[s(I,{cols:"12",md:"12"},{default:a(()=>[s(F,null,{default:a(()=>[s(I,{cols:"12",md:"12"},{default:a(()=>[s(O,{title:"Website"},{default:a(()=>[s(De)]),_:1})]),_:1}),s(I,{cols:"12",md:"12"},{default:a(()=>[t(n)?(k(),R(O,{key:0,title:"Collected Links",class:"pa-0"},{action:a(()=>[z("div",xe,[s(J,{modelValue:t(l),"onUpdate:modelValue":f[0]||(f[0]=W=>A(l)?l.value=W:null),density:"compact",placeholder:"Search..","hide-details":"","prepend-inner-icon":t(Se),variant:"outlined",clearable:""},null,8,["modelValue","prepend-inner-icon"]),s(B,{loading:t(o),color:"error",variant:"flat",onClick:t(r),disabled:t(i).length==0},{default:a(()=>f[2]||(f[2]=[h(" Delete ")])),_:1},8,["loading","onClick","disabled"]),s(B,{loading:t(o),color:"indigo",variant:"flat",onClick:t(c),disabled:t(i).length==0},{default:a(()=>f[3]||(f[3]=[h(" Do Train Agent ")])),_:1},8,["loading","onClick","disabled"])])]),default:a(()=>[s(We)]),_:1})):G("",!0)]),_:1})]),_:1})]),_:1}),s(he,{show:t(g),"onUpdate:show":f[1]||(f[1]=W=>A(g)?g.value=W:null),title:"Warning!",message:"Are you sure you want to delete the selected links?",onConfirm:t(S)},null,8,["show","onConfirm"])]),_:1}))}});export{Me as default};
