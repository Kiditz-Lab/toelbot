import{S as q,C as J,u as j}from"./client-KZQCG3Am.js";import{af as A,ag as N,N as u,ao as V,y as M,O as D,a1 as U,q as X,o as Y,s as G,a as t,ap as H,V as P,w as e,b as h,a5 as b,a7 as k,e as C,aa as z,d as $,t as F,B as d}from"./index-B-4Jq8Ft.js";import{u as R}from"./useApi-Bby6fr-m.js";import{u as K}from"./snackbarStore-KsQP317g.js";const{showSnackbar:Q}=K(),S=R(),B=A("trainingStore",()=>{const r=N(),s=u(null),i=u([]),l=u({}),c=V(()=>S.uploadProgress),w=V(()=>S.downloadProgress),n=u(!1),o=u(0),y=u({page:1,itemsPerPage:20,sortBy:[{key:"url",order:"asc"}]});async function f(){try{const a=r.params.id,{page:m,itemsPerPage:_,sortBy:g}=y.value,T=g.filter(x=>x.order).map(x=>`${x.key},${x.order}`),v={page:m-1,size:_};T.length>0?v.sort=T:v.sort="url,asc";const p=await S.get(`/training-data/${a}`,{type:"FILE",...v});i.value=p.content,o.value=p.totalElements}catch(a){console.error("Error fetching training file:",a)}}async function E(){const a=r.params.id,m=await S.get(`/training-data/${a}/size`);Object.assign(l.value,m)}async function W(){n.value=!0;const a=r.params.id;await S.post(`/training-data/${a}/train-file`),await f(),n.value=!1}async function I(a){await S.del(`/training-data/${a}`)}async function L(a){const m=r.params.id,_=new FormData;a.forEach(g=>{_.append("files",g)}),await S.post(`/training-data/${m}/upload`,_,{"Content-Type":"multipart/form-data"}),await f(),await E()}return{fileChanges:a=>{L(a)},fetchTrainingFile:f,disconnect:()=>{s.value&&s.value.deactivate()},connect:()=>{console.log("Connecting to WebSocket...");const a=r.params.id;if(!a){console.error("Agent ID is required for WebSocket connection.");return}const m="/ws",_=new q(m);s.value=new J({webSocketFactory:()=>_,debug:g=>console.log(g),onConnect:()=>{var g,T;console.log("Connected to WebSocket"),(g=s.value)==null||g.subscribe(`/topic/training/${a}`,v=>{try{const p=JSON.parse(v.body),x=i.value.findIndex(O=>O.id===p.id);x!==-1&&(i.value[x]=p),Q("Your data successfully trained","info",3e3,"Success"),console.log("Received message:",p)}catch(p){console.error("Error parsing WebSocket message:",p)}}),(T=s.value)==null||T.subscribe(`/topic/training-delete/${a}`,async v=>{console.log(v.body),await f()})},onDisconnect:()=>{console.log("Disconnected from WebSocket")}}),s.value.activate()},trainings:i,size:l,fetchTrainingSize:E,uploadProgress:c,downloadProgress:w,trainAgent:W,loading:n,deleteTrainingData:I}}),Z=A("trainingTextStore",()=>{const r=R(),s=u(!1),i=u({}),l=u(""),c=N(),w=V(()=>new TextEncoder().encode(l.value).length);async function n(){const y=c.params.id,f=await r.get(`/training-data/${y}`,{type:"TEXT"});f.length>0&&(i.value=f[0],l.value=f[0].content)}async function o(){s.value=!0;const y=c.params.id;await r.post(`/training-data/${y}/train-text`,{content:l.value}),await n(),s.value=!1}return{text:l,textSize:w,trainTextAgent:o,loading:s,fetchTrainingText:n,training:i}},{persist:!1}),tt={class:"text-h6"},et={class:"text-h6"},at={class:"text-h6"},nt={class:"text-h6"},ut=M({__name:"TrainingSummary",setup(r){const{size:s}=D(B()),{textSize:i}=D(Z()),{fetchTrainingSize:l}=B(),{formatFileSize:c}=j();return U(async()=>{await l()}),(w,n)=>(Y(),X(G,null,[t(P,null,{default:e(()=>[t(h,{cols:"12",md:"12"},{default:e(()=>[t(b,{variant:"outlined"},{default:e(()=>[t(k,{class:"text-h6 text-lightText"},{default:e(()=>n[0]||(n[0]=[C("Total Size")])),_:1}),t(z,null,{default:e(()=>{var o;return[$("div",tt,F(d(c)(((o=d(s))==null?void 0:o.totalSize)+d(i))),1)]}),_:1})]),_:1})]),_:1})]),_:1}),t(P,null,{default:e(()=>[t(h,{cols:"12",md:"6"},{default:e(()=>[t(b,{variant:"outlined"},{default:e(()=>[t(k,{class:"text-h6 text-lightText"},{default:e(()=>n[1]||(n[1]=[C("Link")])),_:1}),t(z,null,{default:e(()=>{var o;return[$("div",et,F(d(c)((o=d(s))==null?void 0:o.urlSize)),1)]}),_:1})]),_:1})]),_:1}),t(h,{cols:"12",md:"6"},{default:e(()=>[t(b,{variant:"outlined"},{default:e(()=>[t(k,{class:"text-h6 text-lightText"},{default:e(()=>n[2]||(n[2]=[C("Text")])),_:1}),t(z,null,{default:e(()=>[$("div",at,F(d(c)(d(i))),1)]),_:1})]),_:1})]),_:1})]),_:1}),t(P,null,{default:e(()=>[t(h,{cols:"12",md:"12"},{default:e(()=>[t(b,{variant:"outlined"},{default:e(()=>[t(k,{class:"text-h6 text-lightText"},{default:e(()=>n[3]||(n[3]=[C("File")])),_:1}),t(z,null,{default:e(()=>{var o;return[$("div",nt,F(d(c)((o=d(s))==null?void 0:o.fileSize)),1)]}),_:1})]),_:1})]),_:1})]),_:1}),H(w.$slots,"default")],64))}});export{ut as _,Z as a,B as u};
