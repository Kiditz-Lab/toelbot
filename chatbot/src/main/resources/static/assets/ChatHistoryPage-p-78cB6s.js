import{af as H,ag as O,N as M,P as v,O as k,a1 as B,c as X,o as C,w,d as I,t as x,B as g,ah as T,y as Y}from"./index-B-4Jq8Ft.js";import{u as F}from"./useApi-Bby6fr-m.js";import{t as D,c as N,n as P,g as b,a as L,e as U,m as A,b as y}from"./en-US-g4IfPCw7.js";const p=H("chatHistoryStore",()=>{const n=F(),t=O(),e=M(t.params.id),s=M([]),r=M(0),o=M(!1),i=M({page:1,itemsPerPage:10,sortBy:[{key:"createdAt",order:"desc"}]});async function a(){if(e.value){o.value=!0;try{const{page:d,itemsPerPage:f,sortBy:u}=i.value,l=u.filter(m=>m.order).map(m=>`${m.key},${m.order}`),c={page:d-1,size:f};l.length>0?c.sort=l:c.sort="createdAt,desc";const h=await n.get(`/histories/${e.value}`,c);s.value=h.content,r.value=h.totalElements}catch(d){console.error("Error fetching chat histories:",d)}finally{o.value=!1}}}return v(i,a,{deep:!0}),v(()=>t.params.id,d=>{e.value=d,a()}),{histories:s,totalItems:r,loading:o,options:i,fetchHistories:a}});function _(n,t){const e=+D(n)-+D(t);return e<0?-1:e>0?1:e}function z(n){return N(n,Date.now())}function E(n,t,e){const[s,r]=P(e==null?void 0:e.in,n,t),o=s.getFullYear()-r.getFullYear(),i=s.getMonth()-r.getMonth();return o*12+i}function R(n){return t=>{const s=(n?Math[n]:Math.trunc)(t);return s===0?0:s}}function $(n,t){return+D(n)-+D(t)}function j(n,t){const e=D(n,t==null?void 0:t.in);return e.setHours(23,59,59,999),e}function V(n,t){const e=D(n,t==null?void 0:t.in),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function q(n,t){const e=D(n,t==null?void 0:t.in);return+j(e,t)==+V(e,t)}function G(n,t,e){const[s,r,o]=P(e==null?void 0:e.in,n,n,t),i=_(r,o),a=Math.abs(E(r,o));if(a<1)return 0;r.getMonth()===1&&r.getDate()>27&&r.setDate(30),r.setMonth(r.getMonth()-i*a);let d=_(r,o)===-i;q(s)&&a===1&&_(s,o)===1&&(d=!1);const f=i*(a-+d);return f===0?0:f}function J(n,t,e){const s=$(n,t)/1e3;return R(e==null?void 0:e.roundingMethod)(s)}function K(n,t,e){const s=L(),r=(e==null?void 0:e.locale)??s.locale??U,o=2520,i=_(n,t);if(isNaN(i))throw new RangeError("Invalid time value");const a=Object.assign({},e,{addSuffix:e==null?void 0:e.addSuffix,comparison:i}),[d,f]=P(e==null?void 0:e.in,...i>0?[t,n]:[n,t]),u=J(f,d),l=(b(f)-b(d))/1e3,c=Math.round((u-l)/60);let h;if(c<2)return e!=null&&e.includeSeconds?u<5?r.formatDistance("lessThanXSeconds",5,a):u<10?r.formatDistance("lessThanXSeconds",10,a):u<20?r.formatDistance("lessThanXSeconds",20,a):u<40?r.formatDistance("halfAMinute",0,a):u<60?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",1,a):c===0?r.formatDistance("lessThanXMinutes",1,a):r.formatDistance("xMinutes",c,a);if(c<45)return r.formatDistance("xMinutes",c,a);if(c<90)return r.formatDistance("aboutXHours",1,a);if(c<A){const m=Math.round(c/60);return r.formatDistance("aboutXHours",m,a)}else{if(c<o)return r.formatDistance("xDays",1,a);if(c<y){const m=Math.round(c/A);return r.formatDistance("xDays",m,a)}else if(c<y*2)return h=Math.round(c/y),r.formatDistance("aboutXMonths",h,a)}if(h=G(f,d),h<12){const m=Math.round(c/y);return r.formatDistance("xMonths",m,a)}else{const m=h%12,S=Math.trunc(h/12);return m<3?r.formatDistance("aboutXYears",S,a):m<9?r.formatDistance("overXYears",S,a):r.formatDistance("almostXYears",S+1,a)}}function Q(n,t){return K(n,z(n),t)}const W={__name:"ChatHistory",setup(n){const t=p(),{histories:e,totalItems:s,loading:r,options:o,fetchHistories:i}=k(t);B(()=>{i.value()});const a=f=>f&&f.toUpperCase().split("").map(u=>String.fromCodePoint(127397+u.charCodeAt(0))).join(""),d=f=>Q(new Date(f),{addSuffix:!0});return(f,u)=>(C(),X(T,{"fixed-header":"","items-per-page":g(o).itemsPerPage,"onUpdate:itemsPerPage":u[0]||(u[0]=l=>g(o).itemsPerPage=l),page:g(o).page,"onUpdate:page":u[1]||(u[1]=l=>g(o).page=l),"sort-by":g(o).sortBy,"onUpdate:sortBy":u[2]||(u[2]=l=>g(o).sortBy=l),items:g(e),headers:[{key:"country",title:"Country"},{key:"createdAt",title:"Created At",sortable:!0},{key:"userMessage",title:"Message"},{key:"model",title:"LLM"}],loading:g(r),"items-length":g(s)},{"item.country":w(({item:l})=>[I("span",null,x(a(l.countryCode))+" "+x(l.country),1)]),"item.createdAt":w(({value:l})=>[I("span",null,x(d(l)),1)]),_:1},8,["items-per-page","page","sort-by","items","loading","items-length"]))}},re=Y({__name:"ChatHistoryPage",setup(n){return(t,e)=>(C(),X(W))}});export{re as default};
